# Test Design: Story 2.3

Date: 2025-09-17
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 7
- Unit tests: 2 (28.5%)
- Integration tests: 5 (71.5%)
- E2E tests: 0 (0%)
- Priority distribution: P0: 5, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1, AC2, AC3, AC4: Backend API Route

| ID | Level | Priority | Test | Justification |
|---|---|---|---|---|
| 2.3-UNIT-001 | Unit | P1 | Verify that the API route handler correctly parses the request payload. | Input validation. |
| 2.3-INT-001 | Integration | P0 | Verify that an unauthenticated request to the API route returns a 401 error. | Security. |
| 2.3-INT-002 | Integration | P0 | Verify that an authenticated request with a valid payload returns a streaming response. | Core functionality. |
| 2.3-INT-003 | Integration | P0 | Verify that the mock streaming response is returned when `OPENROUTER_API_KEY` is not set. | Local development support. |
| 2.3-INT-004 | Integration | P1 | Verify that the OpenRouter API is called when `OPENROUTER_API_KEY` is set. | Core functionality. |

### AC5: Frontend Integration

| ID | Level | Priority | Test | Justification |
|---|---|---|---|---|
| 2.3-UNIT-002 | Unit | P0 | Verify that the frontend correctly handles the streaming response and updates the UI. | User experience. |
| 2.3-INT-005 | Integration | P0 | Verify that the `useChat` hook correctly calls the `/api/ai` endpoint and processes the response. | Frontend-backend integration. |

## Recommended Execution Order

1. P0 Unit tests
2. P0 Integration tests
3. P1 tests in order
