# Risk Profile: Story 2.1

Date: 2025-09-18
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 3
- Critical Risks: 0
- High Risks: 2
- Overall Risk Score: 70/100

## High Risks Requiring Action

### TECH-003: Chat UI depends on unfinished `/api/ai` backend
- **Score:** 6 (High) — Probability: High (3) × Impact: Medium (2)
- **Description:** `useChat` immediately wires the dashboard to `/api/ai`. Story 2.3 has not delivered this endpoint yet, so any send attempt 404s/500s and surfaces framework errors.
- **Affected Components:** `apps/web/app/(protected)/dashboard/page.tsx`, `apps/web/components/chat/message-composer.tsx`
- **Mitigation:** Gate the composer behind feature flags or mock transport until Story 2.3 lands; provide defensive toast/error states so UX remains stable.
- **Testing Focus:** Negative tests that simulate missing/500 API responses and verify graceful UI behaviour.

### TECH-004: Usage meter fetch without backend guarantees
- **Score:** 6 (High) — Probability: High (3) × Impact: Medium (2)
- **Description:** `TopBar` calls `apiClient.getUsage()` on mount, relying on usage service plumbing that is not yet implemented. Unhandled promise rejections pollute logs and can regress hydration when the request throws synchronously.
- **Affected Components:** `apps/web/components/dashboard/top-bar.tsx`, `/lib/api`
- **Mitigation:** Stub usage interactions or guard the request (feature flag, try/catch with fallback UI) until the usage endpoint ships in a later story.
- **Testing Focus:** Integration tests with mocked API client failures to ensure UI degrades gracefully and logging is controlled.

## Medium Risks

### BUS-002: Failed send provides no user feedback
- **Score:** 4 (Medium) — Probability: Medium (2) × Impact: Medium (2)
- **Description:** When `/api/ai` rejects, `append` rejects silently; the composer neither surfaces an error state nor re-enables the send button predictably, eroding trust in the scaffolded UI.
- **Affected Components:** `apps/web/components/chat/message-composer.tsx`, `apps/web/app/(protected)/dashboard/page.tsx`
- **Mitigation:** Surface toast/error banners, reset loading state, and add retry affordances.
- **Testing Focus:** Unit/component tests asserting error UI when `append` rejects (mocked promise rejection).

## Risk Matrix

| Risk ID  | Description                                   | Probability | Impact     | Score | Priority |
|----------|-----------------------------------------------|-------------|------------|-------|----------|
| TECH-003 | Chat UI depends on unfinished `/api/ai` API    | High (3)    | Medium (2) | 6     | High     |
| TECH-004 | Usage meter fetch without backend guarantees   | High (3)    | Medium (2) | 6     | High     |
| BUS-002  | Failed send has no feedback to the end-user    | Medium (2)  | Medium (2) | 4     | Medium   |

## Risk-Based Testing Strategy

1. High-risk focus: simulate 404/500 from `/api/ai` and ensure the dashboard handles errors without breaking layout or crashing the React tree.
2. Validate usage meter guards: mock `apiClient.getUsage()` failures and confirm UI renders a safe fallback while logging once.
3. UX assurance: cover error messaging and button states in component tests for the composer to confirm recoverability.
4. Regression guard: retain existing layout regression tests to ensure core scaffolding (scroll area, composer placement) remains intact while adding new error-handling logic.

## Monitoring & Follow-Up
- Add console/log noise monitoring for the dashboard route until backend services land.
- Revisit risk profile once Story 2.3 delivers the AI stream endpoint and Story 2.x introduces real usage telemetry to retire mitigations.
