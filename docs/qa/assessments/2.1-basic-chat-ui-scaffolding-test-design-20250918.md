# Test Design: Story 2.1

Date: 2025-09-18
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 10
- Unit tests: 3 (30%)
- Integration tests: 4 (40%)
- E2E tests: 3 (30%)
- Priority distribution: P0: 4, P1: 6, P2: 0, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1/AC3/AC4/AC5/AC6: Chat layout renders statically with shadcn/ui primitives
| ID             | Level | Priority | Test                                                                 | Justification |
|----------------|-------|----------|----------------------------------------------------------------------|---------------|
| 2.1-UNIT-001   | Unit  | P0       | Render `DashboardPage` and assert chat thread, composer, sidebar, and top bar mount once. | Guarantees scaffold exists before further logic runs. |
| 2.1-UNIT-002   | Unit  | P1       | Assert `MessageComposer` exposes labelled textarea + send button with disabled state rules. | Accessibility requirement (AC8). |
| 2.1-UNIT-003   | Unit  | P1       | Validate `ChatThread` empty state returns centered placeholder and scroll container props. | Ensures static layout & overflow contract. |

### AC2: Route protection maintained
| ID             | Level       | Priority | Test                                                                 | Justification |
|----------------|-------------|----------|----------------------------------------------------------------------|---------------|
| 2.1-INT-001    | Integration | P0       | With unauthenticated session mock, request `/dashboard` and expect redirect to `/login`. | Prevents regression of protected segment. |
| 2.1-INT-002    | Integration | P1       | With authenticated session mock, render `/dashboard` and ensure 200 response + layout HTML. | Confirms auth guard still allows intended users. |

### AC7/AC8: Responsive and accessible layout behaviour
| ID             | Level | Priority | Test                                                                 | Justification |
|----------------|-------|----------|----------------------------------------------------------------------|---------------|
| 2.1-E2E-001    | E2E   | P0       | Visual regression or manual script at `sm` width validating no overflow, sticky composer, focus traversal. | Mobile UX is core for launch. |
| 2.1-E2E-002    | E2E   | P1       | Same checks at `md` breakpoint.                                      | Tablet UX coverage. |
| 2.1-E2E-003    | E2E   | P1       | Same checks at `lg` breakpoint including sidebar layout balance.     | Desktop UX coverage. |

## Additional Risk Mitigation Scenarios
| ID             | Level       | Priority | Test                                                                 | Mitigates |
|----------------|-------------|----------|----------------------------------------------------------------------|-----------|
| 2.1-INT-003    | Integration | P0       | Mock `/api/ai` to reject; assert composer surfaces error toast, re-enables send, and preserves typed text. | TECH-003, BUS-002 |
| 2.1-INT-004    | Integration | P1       | Mock `apiClient.getUsage()` to throw; verify top bar renders fallback badge without console spam. | TECH-004 |

## Risk Coverage
- TECH-003 → 2.1-INT-003 (requires mitigation implementation).
- TECH-004 → 2.1-INT-004 (requires mitigation implementation).
- BUS-002 → 2.1-INT-003 (composer resiliency scenario).

## Recommended Execution Order
1. Execute P0 unit tests (2.1-UNIT-001) to validate scaffold integrity.
2. Run P0 integration tests (2.1-INT-001, 2.1-INT-003) focusing on auth and API error handling.
3. Perform P0 E2E validation (2.1-E2E-001) to guard mobile experience.
4. Complete remaining P1 tests for accessibility, desktop/tablet layouts, and API fallback logic.

## Coverage Gaps
- None for current scope; defer performance profiling and virtualization checks to future streaming stories (2.3+).

## Execution Notes
- Mock NextAuth session utilities in integration layer to avoid hitting real auth providers.
- Prefer Playwright for responsive E2E checks; fall back to manual checklist if automation unavailable.
