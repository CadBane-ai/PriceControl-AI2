# Story 1.6.1: Avatar Menu Not Opening (Logout Inaccessible)

## Status
Ready

## Story
As a logged-in user, I want to open the account dropdown from the top-right avatar and click “Log out”, so that I can sign out of my account.

## Context
- Observed on production (Vercel) after 1.6 deploy: clicking the top-right avatar showing “PC” does nothing; it appears non-interactive. This prevents access to the “Log out” action delivered in Story 1.6.
- Locally, the dropdown appears to work under typical conditions; issue likely related to layering/z-index or an overlay in production.

## Acceptance Criteria
1. Clicking the top-right avatar opens a dropdown with Account, Billing, Toggle theme, and Log out.
2. Selecting “Log out” invokes `signOut({ callbackUrl: '/login' })` and redirects to `/login`.
3. Dropdown opens on `/dashboard`, `/account`, and `/billing` in Production, Preview, and Dev builds.
4. No visual regressions to header layout; avatar remains focusable and keyboard accessible.

## Tasks / Subtasks

### Phase 1: Diagnosis & Reproduction (Focus on Production Environment)
- [ ] Reproduce the issue on a Vercel Preview/Production to confirm the "PC Open user menu" button is unclickable.
- [ ] Use browser developer tools to inspect the "PC Open user menu" button and its parent elements:
  - [ ] Check for `pointer-events: none` CSS properties.
  - [ ] Examine computed styles for `z-index` and `position`.
  - [ ] Look for overlapping elements.
  - [ ] Monitor console for JavaScript errors or warnings.

### Phase 2: Targeted Investigation & Remediation

#### Cause 1: Event Listener Failure or Overriding
- [ ] Verify event listeners attached to the "PC Open user menu" button.
- [ ] Review `apps/web/components/dashboard/top-bar.tsx` and `apps/web/components/ui/dropdown-menu.tsx` for:
  - [ ] Correct `DropdownMenuTrigger` implementation.
  - [ ] Correct `onClick` handler or dropdown trigger mechanism.
  - [ ] Presence of `e.stopPropagation()` or `e.preventDefault()` that might be interfering.
- [ ] Implement fixes for any identified event listener issues.

#### Cause 2: CSS `pointer-events: none` or similar property
- [ ] Re-confirm the presence of `pointer-events: none` or similar properties on the button or its ancestors.
- [ ] Search `apps/web/app/globals.css` and component-specific CSS for problematic properties.
- [ ] Remove or override the problematic CSS property.

#### Cause 3: Invisible Overlay or Z-index Issue
- [ ] Meticulously examine the `z-index` of the "PC Open user menu" button and all elements that visually overlap it or are positioned above it in the DOM.
- [ ] Review `apps/web/components/dashboard/top-bar.tsx`, `apps/web/app/layout.tsx`, and `apps/web/app/globals.css` for elements creating an overlay or having a high `z-index`.
- [ ] Adjust `z-index` values or modify overlay behavior.

### Phase 3: Verification
- [ ] Test the fix locally across different browsers and screen sizes.
- [ ] Deploy the fix to a Vercel Preview environment and re-test thoroughly on `/dashboard`, `/account`, and `/billing` pages.

## Dev Notes
- Code references:
  - Top bar: `apps/web/components/dashboard/top-bar.tsx`
  - Dropdown UI: `apps/web/components/ui/dropdown-menu.tsx`
  - Session provider: `apps/web/app/layout.tsx`
- Quick mitigation if layering persists: add a visible secondary “Logout” icon button next to the avatar. Keep dropdown as the primary UX.

## Scrum Master Notes
- This plan addresses the issue of the "PC Open user menu" button being unclickable, which was clarified after initial diagnosis. The previous assumption that the dropdown was opening but obscured has been revised. The focus is now on diagnosing why the button itself is not interactive.

## Testing
- Manual:
  - Login → go to `/dashboard` → click avatar → dropdown opens → click “Log out” → redirected to `/login`.
  - Keyboard: Tab to avatar → Enter/Space opens menu → Arrow keys navigate → Enter “Log out”.
  - Repeat on `/account`, `/billing` and on Preview/Prod builds.

## QA Results

- Pending

## Dev Agent Record
- Assigned To: Dev Agent
- Priority: High (blocks sign out)
- Notes: Implement z-index fix and verify in Preview; follow up with additional mitigation only if needed.

